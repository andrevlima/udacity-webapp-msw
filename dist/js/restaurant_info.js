let restaurant;var map;let DOMLoaded=!1;document.addEventListener("DOMContentLoaded",e=>{registerServiceWorker(),bindReviewForm(),DOMLoaded=!0,DBHelper.bindAlertWhenOffOrOn()}),bindReviewForm=(()=>{document.querySelector("#review-form").addEventListener("submit",function(e){const t=getReviewForm();return console.log("Data sent",t),DBHelper.sendReview(t).then(e=>e.json()).then("Response",console.log),Helper.showAlert("Review submited!"),setReviewForm("","",3),e.preventDefault(),e.stopPropagation(),fillRestaurantReviews(),!1})}),setReviewForm=((e,t,r)=>{document.querySelector("#review-name").value=e,document.querySelector(`[name='review-ratio'][value='${r}']`).checked=!0,document.querySelector("#review-comment").value=t}),getReviewForm=(()=>({restaurant_id:getParameterByName("id"),name:document.querySelector("#review-name").value,rating:document.querySelector("[name='review-ratio']:checked").value,comments:document.querySelector("#review-comment").value})),window.initMap=(()=>{fetchRestaurantFromURL((e,t)=>{if(e)console.error(e);else{let e=()=>{self.map=new google.maps.Map(document.getElementById("map"),{zoom:16,center:t.latlng,scrollwheel:!1}),google.maps.event.addListener(self.map,"idle",function(){let e=document.getElementsByTagName("iframe").item(0);e.title="Maps",e.setAttribute("aria-hidden","true")}),DBHelper.mapMarkerForRestaurant(self.restaurant,self.map)};DOMLoaded?setTimeout(e,4e3):document.addEventListener("DOMContentLoaded",t=>setTimeout(e,4e3))}})}),fetchRestaurantFromURL=(e=>{if(self.restaurant)return void e(null,self.restaurant);const t=getParameterByName("id");t?DBHelper.fetchRestaurantById(parseInt(t),t=>{self.restaurant=t,t?(fillRestaurantHTML(),e(null,t)):console.error(error)}):(error="No restaurant id in URL",e(error,null))}),fillRestaurantReviews=(()=>{fetchRestaurantReviews().then(fillReviewsHTML)}),fillRestaurantHTML=((e=self.restaurant)=>{document.getElementById("restaurant-name").innerHTML=e.name,document.getElementById("restaurant-address").innerHTML=e.address;const t=document.getElementById("restaurant-img");t.className="restaurant-img",DBHelper.imageUrlForRestaurant(e,e=>t.src=e);let r=e.photograph_desc?e.photograph_desc:"ilustrative photo of the restaurant";t.alt=`Restaurant ${e.name}, ${r}`;const n=document.getElementById("restaurant-cuisine");n.innerHTML=e.cuisine_type,n.setAttribute("aria-label","Cuisine type is "+e.cuisine_type),fillBreadcrumb(),e.operating_hours&&fillRestaurantHoursHTML(),fillRestaurantReviews()}),fillRestaurantHoursHTML=((e=self.restaurant.operating_hours)=>{const t=document.getElementById("restaurant-hours");for(let r in e){const n=document.createElement("tr"),a=document.createElement("td");a.innerHTML=r,n.appendChild(a);const s=document.createElement("td");s.innerHTML=e[r],n.appendChild(s),t.appendChild(n)}}),fetchRestaurantReviews=((e=getParameterByName("id"))=>Promise.all([fetch(`http://localhost:1337/reviews/?restaurant_id=${e}`,{method:"GET"}).then(e=>e.json()),DBHelper.fetchPedingReviews(e)]).then(e=>e[0].concat(e[1]))),fillReviewsHTML=((e=self.restaurant.reviews)=>{const t=document.getElementById("reviews-container"),r=document.getElementById("reviews-list");if(r.innerHTML="",!e){const e=document.createElement("p");return e.innerHTML="No reviews yet!",void t.appendChild(e)}e.forEach(e=>{r.appendChild(createReviewHTML(e))}),t.appendChild(r)}),createReviewHTML=(e=>{const t=document.createElement("li");t.classList.add("review");const r=document.createElement("div");r.classList.add("review-title");const n=document.createElement("div");n.classList.add("review-content");const a=document.createElement("h4");a.classList.add("review-reviewer"),a.innerHTML=e.name,r.appendChild(a);const s=document.createElement("span");s.classList.add("review-date"),s.innerHTML=new Date(e.createdAt).toDateString(),r.appendChild(s);const o=document.createElement("span");o.classList.add("review-rating"),o.innerHTML=`Rating: ${e.rating}`,n.appendChild(o);const i=document.createElement("p");return i.classList.add("review-comments"),i.innerHTML=e.comments,n.appendChild(i),t.appendChild(r),t.appendChild(n),t}),fillBreadcrumb=((e=self.restaurant)=>{const t=document.getElementById("breadcrumb"),r=document.createElement("li");r.innerHTML=e.name,t.appendChild(r)}),getParameterByName=((e,t)=>{t||(t=window.location.href),e=e.replace(/[\[\]]/g,"\\$&");const r=new RegExp(`[?&]${e}(=([^&#]*)|&|#|$)`).exec(t);return r?r[2]?decodeURIComponent(r[2].replace(/\+/g," ")):"":null}),registerServiceWorker=(()=>{"serviceWorker"in navigator?navigator.serviceWorker.register("/service_worker.js"):console.warn("Oops, seems your browser is not as soo good as Christopher Columbus")});